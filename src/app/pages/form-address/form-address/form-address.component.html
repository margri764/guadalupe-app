
<form  [formGroup]="myForm"    >  
<div class="customShadow w-100 pd-20" style="border-radius: 7px;">

        

        <div class=" d-flex justify-content-end w-100" #top >
   
            <button type="button" class="acceptButton mb-30 mt-30" style="height: 40px;" (click)="showSearchLabel = true">
              <span class="material-icons" style="color: white;">place</span> &nbsp; Nova Endereço          
            </button>
          </div>
        
    <div class="row">   
    
            <div class="col-sm-12 col-12 col-md-6" [ngStyle]="showSearchLabel ? {'display':'block'}:{'display': 'none'}" >
                <mat-label class="font f-w-600 m-b-8 d-block"> <b>Buscar endereço residencial</b> </mat-label>
                <mat-form-field appearance="outline" class="w-100" color="primary"  >
                <input matInput type="text"  formControlName="search" #inputPlaces id="inputPlaces" placeholder="" formControlName="search"  />
               </mat-form-field>
            </div>

        <div class="col-sm-12 col--12 col-md-12 mt-50" >
            <div class="d-flex justify-content-start cursor"  (click)="showMap = !showMap" *ngIf="showMap">
            <span class="material-icons-outlined cursor" style="color: blue" >location_on</span> 
            <span >Ver mapa
            </span>
            </div>
            <div class="d-flex justify-content-start cursor"  (click)="showMap = !showMap" *ngIf="!showMap">
            <span class="material-icons-outlined cursor" style="color: blue" >location_off</span> 
            <span >Ocultar mapa
            </span>
            </div>
            <!-- <div class="maps mt2 shadow " #divMap ></div> -->
            <div class="maps mt-2" #divMap [ngStyle]="showMap ? { 'display': 'none'}:{'display': 'block'}" ></div>
        </div>
    </div>

    <div #form></div>

       <div class="mt-30 row fs-10" >     
        
            <div class=" col-sm-12 col-12 col-md-4 mt-30" >
                <mat-label class="font f-w-600 m-b-8 d-block"> <b> Cidade</b> </mat-label>
                <mat-form-field appearance="outline" class="w-100" color="primary"  >
                <input matInput type="text"  formControlName="city"   />
                @if(f['city'].touched && f['city'].invalid) {
                    <mat-hint class="m-b-16 error-msg">
                    @if(f['city'].errors && f['city'].errors['required']) {
                    <div class="error">Dado obrigatorio.</div>
                    } 
                    </mat-hint>
                    }
                </mat-form-field>
            </div>
       
            <div class=" col-sm-12 col-12 col-md-3 mt-30" >
                <mat-label class="font f-w-600 m-b-8 d-block"> <b> Estado</b> </mat-label>
                <mat-form-field appearance="outline" class="w-100" color="primary"  >
                <input matInput type="text"  formControlName="province"   />
                @if(f['province'].touched && f['province'].invalid) {
                    <mat-hint class="m-b-16 error-msg">
                    @if(f['province'].errors && f['province'].errors['required']) {
                    <div class="error">Dado obrigatorio.</div>
                    } 
                    </mat-hint>
                    }
                </mat-form-field>
            </div>

            <div class="row col-sm-12 col-12 col-md-5">
       
                <div class=" col-sm-12 col-12 col-md-8 mt-30" >
                    <mat-label class="font f-w-600 m-b-8 d-block"> <b> Rua</b> </mat-label>
                    <mat-form-field appearance="outline" class="w-100" color="primary"  >
                    <input matInput type="text"  formControlName="streetName"   />
                    @if(f['streetName'].touched && f['streetName'].invalid) {
                        <mat-hint class="m-b-16 error-msg">
                        @if(f['streetName'].errors && f['streetName'].errors['required']) {
                        <div class="error">Dado obrigatorio.</div>
                        } 
                        </mat-hint>
                        }
                    </mat-form-field>
                </div>
        
                <div class=" col-sm-12 col-12 col-md-4 mt-30" >
                    <mat-label class="font f-w-600 m-b-8 d-block"> <b> Número</b> </mat-label>
                    <mat-form-field appearance="outline" class="w-100" color="primary"  >
                    <input matInput type="text"  formControlName="streetNumber"   />
                    @if(f['streetNumber'].touched && f['streetNumber'].invalid) {
                        <mat-hint class="m-b-16 error-msg">
                        @if(f['streetNumber'].errors && f['streetNumber'].errors['required']) {
                        <div class="error">Dado obrigatorio.</div>
                        } 
                        </mat-hint>
                        }
                    </mat-form-field>
                </div>
            </div>
      
       </div>

       <div class="mt-30 row fs-10">

            <div class=" col-sm-12 col-12 col-md-4 mt-30" >
                <mat-label class="font f-w-600 m-b-8 d-block"> <b> Bairro</b> </mat-label>
                <mat-form-field appearance="outline" class="w-100" color="primary"  >
                <input matInput type="text"  formControlName="neighborhood"   />
                @if(f['neighborhood'].touched && f['neighborhood'].invalid) {
                    <mat-hint class="m-b-16 error-msg">
                    @if(f['neighborhood'].errors && f['neighborhood'].errors['required']) {
                    <div class="error">Dado obrigatorio.</div>
                    } 
                    </mat-hint>
                    }
                </mat-form-field>
            </div>

                
            <div class=" col-sm-12 col-12 col-md-4 mt-30" >
                <mat-label class="font f-w-600 m-b-8 d-block"> <b> CEP</b> </mat-label>
                <mat-form-field appearance="outline" class="w-100" color="primary"  >
                <input matInput type="text"  formControlName="postal_code"   />
                @if(f['postal_code'].touched && f['postal_code'].invalid) {
                    <mat-hint class="m-b-16 error-msg">
                    @if(f['postal_code'].errors && f['postal_code'].errors['required']) {
                    <div class="error">Dado obrigatorio.</div>
                    } 
                    </mat-hint>
                    }
                </mat-form-field>
            </div>

            
            <div class=" col-sm-12 col-12 col-md-4 mt-30" >
                <mat-label class="font f-w-600 m-b-8 d-block">Observações <b style="color: red;">*</b></mat-label>
                <textarea  class="w-100" formControlName="description" (input)="limitCharacters($event)" style="height: 38px;"></textarea>
                <div class="d-flex justify-content-end w-100 mt-1 fs-8 font" [ngStyle]="{'color': remainingCharacters === 0 ? 'red' : 'black'}" >{{ remainingCharacters }} de 250 caracteres restantes</div>
                @if(f['description'].touched && f['description'].invalid) {
                  @if(f['description'].errors && f['description'].errors['required']) {
                  <div class="error">Dado obrigatorio.</div>
                  } 
                  }
              </div>


       </div>     

       <div class="mt-3 col-4" > 
        <input type="text"  class="form-control" formControlName="coords" style="display: none;">
       </div>


       <div class="col-sm-12 col-xs-12 col-md-4 mt-30">
        <button type="button" class="acceptButton" (click)="onSaveForm()" > Salvar </button>
       </div> 



    <div #addedAdress style="margin-top: 10px;"></div>

    <div class="row w-100" style="padding: 10px;" *ngIf="addresses.length > 0">
           
        <div class="border w-100 mt-3"></div>

            <div class="mb-3 mt-30 col-sm-12 col-12 col-md-12" *ngIf="addresses.length > 0" style="overflow-y: auto;">

                <span class="d-block text w-100 fs-10">Tipo de endereço</span> 

                <div class="row mt-2 mb-10 pd-10 ">

                    <div class="col-sm-12 col-12 col-md-7 " >
                        <span class="text"> Endereço </span>
                    </div>

                    <div class="col-sm-12 col-12 col-md-3 ">
                      <span class="d-block text" style="text-align: start;"> Tipo </span>
                   </div>
                    <div class="col-sm-12 col-12 col-md-2 ">
                        <span class="d-block text" style="text-align: end;"> Acciones</span>
                    </div>
               </div>

                 <div class="row hovering" *ngFor="let address of addressSegmentationPairs; let i = index"  >

                    <div class="col-7 mt-10">
                      <span class=" d-block font fs-10 w-100 selected" (click)="setPinOnMap(address)"> {{address.address}} </span>
                    </div>
            
                    <div class="col-3 mt-10 ">
                      <span *ngIf="(address.segmentation !== '')" style="text-align: start; font-weight: 700; font-family: poppins-regular; font-size: 1em;"> {{address.segmentation}} </span>
                      <div class="d-flex justify-content-start align-items-center" *ngIf="(address.segmentation === '')">
                        <span class="material-icons  animate__animated animate__flash" style="color: red;">error   </span> 
                        <span class="font" style="color: red; font-size: 0.8em;">(agregar tipo)</span>
                      </div>
                    </div>

                   <div class="col-2 mt-10" style="text-align: end;" >
                     <span class="material-icons cursor" (click)="toggleCollapse(i)" >more_vert</span>
                     <mat-icon (click)="removeAddress(address)" style="color: red; cursor: pointer;" >delete</mat-icon>
                   </div>
             
                   <div *ngIf="selectedIndex === i">

                        <mat-form-field appearance="outline" style="width: 180px !important;" color="primary"  >
                          <input type="text" class="select cursor" style=" margin-top: 1px; " placeholder="Procure aqui"  matInput [matAutocomplete]="autophone2" (keyup)="onSearchChange($event)" (blur)="clearSearch()" formControlName="pairAddress">
                          <mat-autocomplete #autophone2="matAutocomplete" (optionSelected)="onAddressSelected(address, $event)" >
                            <mat-option *ngFor="let option of addressOptions | async" [value]="option">
                              <span [innerHTML]="resaltarCoincidencias(option, searchText)"></span>
                            </mat-option>
                          </mat-autocomplete>
                          </mat-form-field>
                          <span class="font fs-10 selected" (click)="toggleCollapse(i)"> Selecionar</span> 
                      </div>

                 </div>

       
            </div>
        </div>
    </div>

</form>


<div class="loading-overlay" *ngIf="isLoading">
  <div class="spinner-grow " role="status" style="width: 50px; height: 50px;"  >
    <span class="sr-only">Loading...</span>
  </div>
</div> 

    
